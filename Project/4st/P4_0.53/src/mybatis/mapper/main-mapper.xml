<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="main">

	<select id="selectTodayCountList" resultType="TB_ORDER_STATE">
		SELECT B.CPN_NM AS ORDER_CH_NM, 
			COUNT(A.ORD_ID) AS TOTAL_COUNT,  
			SUM(A.TOT_AMT) AS TOTAL_AMT, 
			SUM(CASE WHEN NOT A.ORD_STATE = 'cancel' THEN 1 ELSE 0 END) AS COMMIT_COUNT,
			SUM(CASE WHEN NOT A.ORD_STATE = 'cancel' THEN A.TOT_AMT ELSE 0 END) AS COMMIT_AMT,
			SUM(CASE WHEN A.ORD_STATE = 'cancel' THEN 1 ELSE 0 END) AS CANCEL_COUNT,
			SUM(CASE WHEN A.ORD_STATE = 'cancel' THEN A.TOT_AMT ELSE 0 END) AS CANCEL_AMT
		FROM TB_ORDER_STATE A
		INNER JOIN EM_COMPANY_MASTER_OMS B ON B.CPN_CD = A.FRANCHISE_CODE AND B.CPN_TYPE = 'ORDER'
		WHERE A.REGDATE BETWEEN to_date(SYSDATE) AND to_date(SYSDATE)+0.99999
		GROUP BY ROLLUP(B.CPN_NM)
	</select>
	
	<select id="selectYesCountList" resultType="TB_ORDER_STATE">
		SELECT B.CPN_NM AS ORDER_CH_NM, 
			COUNT(A.ORD_ID) AS TOTAL_COUNT,  
			SUM(A.TOT_AMT) AS TOTAL_AMT, 
			SUM(CASE WHEN NOT A.ORD_STATE = 'cancel' THEN 1 ELSE 0 END) AS COMMIT_COUNT,
			SUM(CASE WHEN NOT A.ORD_STATE = 'cancel' THEN A.TOT_AMT ELSE 0 END) AS COMMIT_AMT,
			SUM(CASE WHEN A.ORD_STATE = 'cancel' THEN 1 ELSE 0 END) AS CANCEL_COUNT,
			SUM(CASE WHEN A.ORD_STATE = 'cancel' THEN A.TOT_AMT ELSE 0 END) AS CANCEL_AMT
		FROM TB_ORDER_STATE A
		INNER JOIN EM_COMPANY_MASTER_OMS B ON B.CPN_CD = A.FRANCHISE_CODE AND B.CPN_TYPE = 'ORDER'
		WHERE A.REGDATE BETWEEN to_date(SYSDATE-1) AND to_date(SYSDATE-1)+0.99999
		GROUP BY ROLLUP(B.CPN_NM)
	</select>
	
	<select id="selectDeliveryNumber" resultType="EM_COMPANY_MASTER_OMS">
		SELECT CPN_NM, CPN_TEL 
		FROM EM_COMPANY_MASTER_OMS 
		WHERE CPN_TYPE = 'DELIVERY'
		ORDER BY CPN_NM
	</select>
	
	<select id="selectFranchiseNumber" resultType="EM_COMPANY_MASTER_OMS">
		SELECT CPN_NM, CPN_TEL 
		FROM EM_COMPANY_MASTER_OMS 
		WHERE CPN_TYPE = 'ORDER'
		ORDER BY CPN_NM
	</select>

</mapper>
